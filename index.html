<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candi Tikus - Calibration Mode</title>
    
    <script src="https://unpkg.com/coi-serviceworker/coi-serviceworker.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lato:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Lato', sans-serif; }

        /* UI Layer yang "Tembus Pandang" untuk Mouse */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* PENTING: Biar klik tembus ke model 3D */
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* Header */
        header {
            pointer-events: auto; text-align: center; padding-top: 20px;
            color: #d4af37; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        h1 { margin: 0; font-family: 'Cinzel', serif; letter-spacing: 2px; }

        /* Panel Info (Diperkecil areanya agar tidak memblokir layar) */
        #info-panel {
            pointer-events: auto; /* Hanya area kotak ini yang bisa diklik */
            width: 90%; max-width: 350px;
            margin: 0 auto; /* Tengah */
            background: rgba(20, 20, 20, 0.85);
            border-top: 3px solid #d4af37;
            border-radius: 10px;
            padding: 15px;
            color: #eee;
            /* Kita taruh agak ke atas sedikit dari tombol bawah */
            margin-bottom: 10px;
        }
        #info-panel h3 { margin-top: 0; color: #d4af37; font-family: 'Cinzel', serif; }
        
        /* Tombol Kontrol Bawah */
        #controls {
            pointer-events: auto;
            display: flex; justify-content: center; gap: 15px;
            padding-bottom: 30px;
        }
        .btn {
            background: #333; color: white; border: 1px solid #555;
            width: 50px; height: 50px; border-radius: 50%;
            font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .btn:active { background: #d4af37; color: black; }

        /* Loading */
        #loader {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #d4af37; font-family: sans-serif; font-size: 1.2rem;
            text-align: center; pointer-events: none;
        }
    </style>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
            "gaussian-splats-3d": "https://unpkg.com/@mkkellogg/gaussian-splats-3d@0.2.1/build/gaussian-splats-3d.module.js"
        }
    }
    </script>
</head>
<body>

    <div id="loader">Sedang Mencari Candi Tikus...<br><small>Tunggu sebentar</small></div>

    <div id="ui-layer">
        <header>
            <h1>CANDI TIKUS</h1>
            <small style="color:white; opacity:0.7;">Geser 1 Jari: Putar | 2 Jari: Geser Posisi</small>
        </header>

        <div>
            <div id="info-panel">
                <h3>Petunjuk Kalibrasi</h3>
                <p style="font-size: 0.9rem; margin-bottom: 0;">
                    Jika model tidak terlihat:
                    <br>1. Gunakan tombol <b>(-)</b> untuk Zoom Out (Mundur).
                    <br>2. Gunakan tombol <b>(‚ü≥)</b> untuk Reset Kamera.
                </p>
            </div>

            <div id="controls">
                <button class="btn" onclick="zoomCamera(1)" title="Maju (+)"><i class="fas fa-plus"></i></button>
                <button class="btn" onclick="resetCamera()" title="Reset View"><i class="fas fa-sync"></i></button>
                <button class="btn" onclick="zoomCamera(-1)" title="Mundur (-)"><i class="fas fa-minus"></i></button>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as GaussianSplats3D from 'gaussian-splats-3d';

        const fileModel = 'Candi_Tikus_GS_2.splat'; 

        // 1. Setup Viewer dengan Kamera Lebih Jauh (Z = 10)
        const viewer = new GaussianSplats3D.Viewer({
            'cameraUp': [0, 1, 0],
            'initialCameraPosition': [0, 2, 10], // Mundur 10 meter ke belakang
            'initialCameraLookAt': [0, 0, 0],    // Fokus ke titik tengah (0,0,0)
            'sharedMemoryForWorkers': false,
            'useBuiltInControls': true
        });

        // Variabel global untuk akses mesh
        window.candiMesh = null;

        viewer.addSplatScene(fileModel, {
            'splatAlphaRemovalThreshold': 5,
            'showLoadingUI': false
        })
        .then(() => {
            viewer.start();
            
            // Hapus Loading Text
            document.getElementById('loader').style.display = 'none';

            // --- SETTING POSISI AMAN (DEFAULT) ---
            window.candiMesh = viewer.splatMesh;
            if (window.candiMesh) {
                // Kita kembalikan ke 0 dulu biar ketahuan aslinya dimana
                window.candiMesh.position.set(0, 0, 0); 
                window.candiMesh.rotation.set(0, 0, 0);
                window.candiMesh.scale.set(1.5, 1.5, 1.5); // Perbesar sedikit

                // PERBAIKAN ROTASI (Opsi Paling Umum untuk Splatting)
                // Coba nyalakan baris di bawah ini HANYA jika modelnya tidur/miring
                // window.candiMesh.rotation.x = -Math.PI / 2; 
                
                console.log("Model Loaded at 0,0,0");
            }
        })
        .catch(err => {
            document.getElementById('loader').innerHTML = "Error: " + err;
        });

        // --- FUNGSI KONTROL ---
        
        // Reset Kamera ke posisi awal
        window.resetCamera = function() {
            // Cara manual reset kamera simpel
            viewer.cameraControl.zoomOut(100); // Zoom out paksa
            alert("Kamera direset. Coba geser layar sekarang.");
            location.reload();
        };

        // Fungsi Zoom Manual lewat Tombol
        window.zoomCamera = function(direction) {
            // direction: 1 (Maju), -1 (Mundur)
            const cam = viewer.cameraControl.camera;
            // Geser kamera di sumbu Z
            cam.position.z -= direction * 2; 
            cam.updateProjectionMatrix();
        };

    </script>
</body>
</html>
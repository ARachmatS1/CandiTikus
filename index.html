<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALAT KALIBRASI CANDI TIKUS</title>
    
    <script src="coi-serviceworker.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #111; font-family: monospace; color: #0f0; }

        /* Panel Kontrol Mengambang */
        #debug-panel {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(0, 0, 0, 0.85);
            border-top: 2px solid #0f0;
            padding: 10px;
            box-sizing: border-box;
            display: flex; flex-direction: column; gap: 5px;
            z-index: 999;
            max-height: 50vh; overflow-y: auto;
        }

        .row { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #333; padding: 5px 0; }
        .label { width: 80px; font-weight: bold; font-size: 1rem; color: #fff; }
        .value { width: 60px; text-align: center; color: #0f0; font-weight: bold; font-size: 1.1rem; }
        
        .btn-group { display: flex; gap: 5px; }
        button {
            background: #222; color: #fff; border: 1px solid #555;
            padding: 10px 15px; font-size: 1.2rem; cursor: pointer; border-radius: 5px;
            touch-action: manipulation; /* Biar enak di HP */
        }
        button:active { background: #0f0; color: #000; }

        #header-info {
            position: absolute; top: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.5); text-align: center; padding: 10px;
            pointer-events: none; color: white;
        }
    </style>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
            "gaussian-splats-3d": "https://unpkg.com/@mkkellogg/gaussian-splats-3d@0.2.1/build/gaussian-splats-3d.module.js"
        }
    }
    </script>
</head>
<body>

    <div id="header-info">
        <h3>MODE KALIBRASI</h3>
        <small>Atur posisi sampai pas, lalu SS/Catat angkanya!</small>
    </div>

    <div id="debug-panel">
        
        <div class="row">
            <span class="label">X (Samping)</span>
            <div class="btn-group">
                <button onclick="update('x', -0.5)">◀ Kiri</button>
                <button onclick="update('x', 0.5)">Kanan ▶</button>
            </div>
            <span class="value" id="val-x">0</span>
        </div>

        <div class="row">
            <span class="label">Y (Tinggi)</span>
            <div class="btn-group">
                <button onclick="update('y', -0.5)">▼ Turun</button>
                <button onclick="update('y', 0.5)">Naik ▲</button>
            </div>
            <span class="value" id="val-y">0</span>
        </div>

        <div class="row">
            <span class="label">Z (Jarak)</span>
            <div class="btn-group">
                <button onclick="update('z', -0.5)">Jauh</button>
                <button onclick="update('z', 0.5)">Dekat</button>
            </div>
            <span class="value" id="val-z">0</span>
        </div>

        <div class="row">
            <span class="label">Putar</span>
            <div class="btn-group">
                <button onclick="update('rot', -0.1)">↺ Kiri</button>
                <button onclick="update('rot', 0.1)">Kanan ↻</button>
            </div>
            <span class="value" id="val-rot">0</span>
        </div>

         <div class="row">
            <span class="label">Ukuran</span>
            <div class="btn-group">
                <button onclick="update('scale', -0.1)">Kecil</button>
                <button onclick="update('scale', 0.1)">Besar</button>
            </div>
            <span class="value" id="val-scale">0</span>
        </div>

        <div style="text-align: center; margin-top: 10px;">
            <small style="color:#aaa">Refresh halaman jika hilang</small>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import * as GaussianSplats3D from 'gaussian-splats-3d';

        // --- DATA AWAL (MULAI DARI SINI) ---
        // Ini angka terakhir yang kita pakai
        let params = {
            x: -23.0,
            y: -5.0, 
            z: 6.0,
            rot: 3.14, // Sekitar 180 derajat
            scale: 1.5
        };

        const viewer = new GaussianSplats3D.Viewer({
            'cameraUp': [0, 1, 0],
            'initialCameraPosition': [0, 0, 15], // Kamera mundur jauh biar kelihatan semua
            'initialCameraLookAt': [0, 0, 0],
            'sharedMemoryForWorkers': false,
            'useBuiltInControls': true
        });

        window.candiMesh = null;

        viewer.addSplatScene('Candi_Tikus_GS_2.splat', {
            'splatAlphaRemovalThreshold': 5,
            'showLoadingUI': true
        })
        .then(() => {
            viewer.start();
            window.candiMesh = viewer.splatMesh;
            
            // Terapkan posisi awal
            applyTransform();
            updateDisplay();
        });

        // Fungsi Update Model
        function applyTransform() {
            if (!window.candiMesh) return;
            window.candiMesh.position.x = params.x;
            window.candiMesh.position.y = params.y;
            window.candiMesh.position.z = params.z;
            window.candiMesh.rotation.z = params.rot;
            window.candiMesh.scale.set(params.scale, params.scale, params.scale);
        }

        // Fungsi Update Angka di Layar
        function updateDisplay() {
            document.getElementById('val-x').innerText = params.x.toFixed(1);
            document.getElementById('val-y').innerText = params.y.toFixed(1);
            document.getElementById('val-z').innerText = params.z.toFixed(1);
            document.getElementById('val-rot').innerText = params.rot.toFixed(2);
            document.getElementById('val-scale').innerText = params.scale.toFixed(1);
        }

        // Fungsi Tombol (Global)
        window.update = function(type, val) {
            if (type === 'x') params.x += val;
            if (type === 'y') params.y += val;
            if (type === 'z') params.z += val;
            if (type === 'rot') params.rot += val;
            if (type === 'scale') params.scale += val;
            
            applyTransform();
            updateDisplay();
        };

    </script>
</body>
</html>